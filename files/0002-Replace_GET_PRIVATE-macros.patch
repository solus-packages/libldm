From ebb4ac45d6720376f22277d8f93402808f64e987 Mon Sep 17 00:00:00 2001
From: Hilko Bengen <bengen@hilluzination.de>
Date: Sat, 9 Nov 2019 11:48:52 +0100
Subject: [PATCH] Replace *_GET_PRIVATE macros with *_get_instance_private
 functions

This fixes build failures with GLib 2.62 (Debian bug #944397)
---
 src/ldm.c | 25 +++++--------------------
 1 file changed, 5 insertions(+), 20 deletions(-)

diff --git a/src/ldm.c b/src/ldm.c
index 29a545d..86ad539 100644
--- a/src/ldm.c
+++ b/src/ldm.c
@@ -304,9 +304,6 @@ ldm_ ## object ## _get_ ## property(const klass * const o)                     \
 
 /* LDM */
 
-#define LDM_GET_PRIVATE(obj)       (G_TYPE_INSTANCE_GET_PRIVATE \
-        ((obj), LDM_TYPE, LDMPrivate))
-
 struct _LDMPrivate
 {
     GArray *disk_groups;
@@ -330,7 +327,7 @@ ldm_dispose(GObject * const object)
 static void
 ldm_init(LDM * const o)
 {
-    o->priv = LDM_GET_PRIVATE(o);
+    o->priv = ldm_get_instance_private(o);
     bzero(o->priv, sizeof(*o->priv));
 
     /* Provide our logging function. */
@@ -349,9 +346,6 @@ ldm_class_init(LDMClass * const klass)
 
 /* LDMDiskGroup */
 
-#define LDM_DISK_GROUP_GET_PRIVATE(obj)    (G_TYPE_INSTANCE_GET_PRIVATE \
-        ((obj), LDM_TYPE_DISK_GROUP, LDMDiskGroupPrivate))
-
 struct _LDMDiskGroupPrivate
 {
     uuid_t guid;
@@ -474,7 +468,7 @@ ldm_disk_group_class_init(LDMDiskGroupClass * const klass)
 static void
 ldm_disk_group_init(LDMDiskGroup * const o)
 {
-    o->priv = LDM_DISK_GROUP_GET_PRIVATE(o);
+    o->priv = ldm_disk_group_get_instance_private(o);
     bzero(o->priv, sizeof(*o->priv));
 }
 
@@ -500,9 +494,6 @@ ldm_volume_type_get_type(void)
 
 /* LDMVolume */
 
-#define LDM_VOLUME_GET_PRIVATE(obj) (G_TYPE_INSTANCE_GET_PRIVATE \
-        ((obj), LDM_TYPE_VOLUME, LDMVolumePrivate))
-
 typedef enum {
     _VOLUME_TYPE_GEN = 0x3,
     _VOLUME_TYPE_RAID5 = 0x4
@@ -744,7 +735,7 @@ ldm_volume_class_init(LDMVolumeClass * const klass)
 static void
 ldm_volume_init(LDMVolume * const o)
 {
-    o->priv = LDM_VOLUME_GET_PRIVATE(o);
+    o->priv = ldm_volume_get_instance_private(o);
     bzero(o->priv, sizeof(*o->priv));
 
     /* We don't have a trivial way to initialize this array to the correct size
@@ -784,9 +775,6 @@ _cleanup_comp(gpointer const data)
 
 /* LDMPartition */
 
-#define LDM_PARTITION_GET_PRIVATE(obj) (G_TYPE_INSTANCE_GET_PRIVATE \
-        ((obj), LDM_TYPE_PARTITION, LDMPartitionPrivate))
-
 struct _LDMPartitionPrivate
 {
     guint32 id;
@@ -912,15 +900,12 @@ ldm_partition_class_init(LDMPartitionClass * const klass)
 static void
 ldm_partition_init(LDMPartition * const o)
 {
-    o->priv = LDM_PARTITION_GET_PRIVATE(o);
+    o->priv = ldm_partition_get_instance_private(o);
     bzero(o->priv, sizeof(*o->priv));
 }
 
 /* LDMDisk */
 
-#define LDM_DISK_GET_PRIVATE(obj) (G_TYPE_INSTANCE_GET_PRIVATE \
-        ((obj), LDM_TYPE_DISK, LDMDiskPrivate))
-
 struct _LDMDiskPrivate
 {
     guint32 id;
@@ -1127,7 +1112,7 @@ ldm_disk_class_init(LDMDiskClass * const klass)
 static void
 ldm_disk_init(LDMDisk * const o)
 {
-    o->priv = LDM_DISK_GET_PRIVATE(o);
+    o->priv = ldm_disk_get_instance_private(o);
     bzero(o->priv, sizeof(*o->priv));
 }
 
